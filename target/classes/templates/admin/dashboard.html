<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Category & Product Management</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body {
            background-color: #f8f9fa;
        }
        
        .header-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .nav-tabs .nav-link {
            color: #667eea;
            font-weight: 500;
        }
        
        .nav-tabs .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }
        
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .table th {
            background-color: #f8f9fa;
            border-top: none;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header-section">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-2 text-center">
                <img src="/uploads/avatars/avatar.jpg" alt="Profile" class="profile-img" 
                    onerror="this.src='/images/default_image.png'">
                         style="width: 60px; height: 60px; border-radius: 50%; border: 3px solid white;"
                         onerror="this.src='https://via.placeholder.com/60x60/667eea/ffffff?text=TP'">
                </div>
                <div class="col-md-8">
                    <h1 class="navbar-brand mb-0">
                        <i class="fas fa-tachometer-alt me-2"></i>
                        Admin Dashboard
                    </h1>
                    <p class="mb-0">Quản lý Category và Product</p>
                </div>
                <div class="col-md-2 text-end">
                    <a href="/swagger-ui/index.html" class="btn btn-outline-light me-2" target="_blank">
                        <i class="fas fa-code me-1"></i>
                        API Docs
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mt-4">
        <!-- Alert Container -->
        <div id="alertContainer"></div>
        
        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs" id="adminTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="categories-tab" data-bs-toggle="tab"
                        data-bs-target="#categories" type="button" role="tab">
                    <i class="fas fa-layer-group me-2"></i>
                    Quản lý Category
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="products-tab" data-bs-toggle="tab"
                        data-bs-target="#products" type="button" role="tab">
                    <i class="fas fa-box me-2"></i>
                    Quản lý Product
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="users-tab" data-bs-toggle="tab"
                        data-bs-target="#users" type="button" role="tab">
                    <i class="fas fa-users me-2"></i>
                    Quản lý Users
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="adminTabsContent">
            <!-- Categories Tab -->
            <div class="tab-pane fade show active" id="categories" role="tabpanel">
                <div class="card mt-3">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-layer-group me-2"></i>
                            Danh sách Category
                        </h5>
                        <button class="btn btn-primary" onclick="openCategoryModal()">
                            <i class="fas fa-plus me-1"></i>
                            Thêm Category
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- Search and Filter -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <input type="text" class="form-control" id="categorySearch" 
                                       placeholder="Tìm kiếm category...">
                            </div>
                            <div class="col-md-6">
                                <select class="form-select" id="categoryPageSize">
                                    <option value="5">5 items/trang</option>
                                    <option value="10" selected>10 items/trang</option>
                                    <option value="20">20 items/trang</option>
                                    <option value="50">50 items/trang</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Categories Table -->
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th width="5%">#</th>
                                        <th width="10%">Icon</th>
                                        <th width="40%">Tên Category</th>
                                        <th width="20%">Ngày tạo</th>
                                        <th width="25%">Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody id="categoriesTableBody">
                                    <!-- Categories will be loaded here via AJAX -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Pagination -->
                        <nav aria-label="Categories pagination">
                            <ul class="pagination justify-content-center" id="categoriesPagination">
                                <!-- Pagination will be generated here -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>

            <!-- Products Tab -->
            <div class="tab-pane fade" id="products" role="tabpanel">
                <div class="card mt-3">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-box me-2"></i>
                            Danh sách Product
                        </h5>
                        <button class="btn btn-primary" onclick="openProductModal()">
                            <i class="fas fa-plus me-1"></i>
                            Thêm Product
                        </button>
                    </div>
                    <div class="card-body">
                        <!-- Search and Filter -->
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <input type="text" class="form-control" id="productSearch" 
                                       placeholder="Tìm kiếm sản phẩm...">
                            </div>
                            <div class="col-md-4">
                                <select class="form-select" id="productCategoryFilter">
                                    <option value="">Tất cả category</option>
                                    <!-- Categories will be loaded here -->
                                </select>
                            </div>
                            <div class="col-md-4">
                                <select class="form-select" id="productPageSize">
                                    <option value="5">5 items/trang</option>
                                    <option value="10" selected>10 items/trang</option>
                                    <option value="20">20 items/trang</option>
                                    <option value="50">50 items/trang</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Products Table -->
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th width="5%">#</th>
                                        <th width="8%">Ảnh</th>
                                        <th width="20%">Tên sản phẩm</th>
                                        <th width="12%">Category</th>
                                        <th width="15%">Giá</th>
                                        <th width="8%">SL</th>
                                        <th width="8%">Giảm giá</th>
                                        <th width="10%">Trạng thái</th>
                                        <th width="14%">Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody id="productsTableBody">
                                    <!-- Products will be loaded here via AJAX -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Pagination -->
                        <nav aria-label="Products pagination">
                            <ul class="pagination justify-content-center" id="productsPagination">
                                <!-- Pagination will be generated here -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>

            <!-- Users Tab -->
            <div class="tab-pane fade" id="users" role="tabpanel">
                <div class="card mt-3">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-users me-2"></i>
                            Danh sách Users
                        </h5>
                        <a href="/users/new" class="btn btn-primary" target="_blank">
                            <i class="fas fa-plus me-1"></i>
                            Thêm User
                        </a>
                    </div>
                    <div class="card-body">
                        <!-- Search and Filter -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <input type="text" class="form-control" id="userSearch"
                                       placeholder="Tìm kiếm user...">
                            </div>
                            <div class="col-md-6">
                                <select class="form-select" id="userPageSize">
                                    <option value="5">5 items/trang</option>
                                    <option value="10" selected>10 items/trang</option>
                                    <option value="20">20 items/trang</option>
                                    <option value="50">50 items/trang</option>
                                </select>
                            </div>
                        </div>

                        <!-- Users Table -->
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th width="5%">#</th>
                                        <th width="8%">Avatar</th>
                                        <th width="25%">Họ tên</th>
                                        <th width="25%">Email</th>
                                        <th width="15%">Số điện thoại</th>
                                        <th width="10%">Trạng thái</th>
                                        <th width="12%">Thao tác</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- Users will be loaded here via AJAX -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <nav aria-label="Users pagination">
                            <ul class="pagination justify-content-center" id="usersPagination">
                                <!-- Pagination will be generated here -->
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Category Modal -->
    <div class="modal fade" id="categoryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="categoryModalTitle">Thêm Category</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="categoryForm">
                        <input type="hidden" id="categoryId">
                        <div class="mb-3">
                            <label for="categoryName" class="form-label">Tên Category *</label>
                            <input type="text" class="form-control" id="categoryName" required>
                        </div>
                        <div class="mb-3">
                            <label for="categoryIcon" class="form-label">Icon</label>
                            <input type="file" class="form-control" id="categoryIcon" accept="image/*">
                            <div class="form-text">Chọn file ảnh cho icon category (JPG, PNG, GIF)</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-primary" onclick="saveCategoryForm()">Lưu</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div class="modal fade" id="productModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="productModalTitle">Thêm Product</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="productForm">
                        <input type="hidden" id="productId">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productName" class="form-label">Tên sản phẩm *</label>
                                    <input type="text" class="form-control" id="productName" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productCategory" class="form-label">Category *</label>
                                    <select class="form-select" id="productCategory" required>
                                        <option value="">Chọn category</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="productUnitPrice" class="form-label">Giá (VNĐ) *</label>
                                    <input type="number" class="form-control" id="productUnitPrice" 
                                           min="0" step="1000" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="productQuantity" class="form-label">Số lượng *</label>
                                    <input type="number" class="form-control" id="productQuantity" 
                                           min="0" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="productDiscount" class="form-label">Giảm giá (%)</label>
                                    <input type="number" class="form-control" id="productDiscount" 
                                           min="0" max="100" step="0.01" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="productDescription" class="form-label">Mô tả</label>
                            <textarea class="form-control" id="productDescription" rows="3"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productImages" class="form-label">Ảnh sản phẩm</label>
                                    <input type="file" class="form-control" id="productImages" accept="image/*">
                                    <div class="form-text">Chọn file ảnh cho sản phẩm (JPG, PNG, GIF)</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="productStatus" class="form-label">Trạng thái</label>
                                    <select class="form-select" id="productStatus">
                                        <option value="true">Hoạt động</option>
                                        <option value="false">Ngừng bán</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-primary" onclick="saveProductForm()">Lưu</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-3 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-1"><strong>Sinh viên:</strong> Trần Phúc Toàn</p>
                    <p class="mb-0"><strong>MSSV:</strong> 23110344</p>
                </div>
                <div class="col-md-6">
                    <p class="mb-1"><strong>Lớp:</strong> 231102A</p>
                    <p class="mb-0"><strong>Bài tập:</strong> RESTful API + AJAX</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Main JS -->
    <script src="/js/main.js"></script>
    
    <script>
        // Initialize when document is ready
        $(document).ready(function() {
            // Load categories for filter dropdown
            loadCategoriesForFilter();
        });
        
        function loadCategoriesForFilter() {
            $.ajax({
                url: '/api/category?size=1000',
                method: 'GET',
                success: function(response) {
                    if (response.status === 'success') {
                        const select = $('#productCategoryFilter');
                        select.empty();
                        select.append('<option value="">Tất cả category</option>');
                        
                        response.body.content.forEach(function(category) {
                            select.append(`<option value="${category.cateid}">${category.catename}</option>`);
                        });
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error loading categories for filter:', error);
                }
            });
        }
    </script>
</body>
</html>
