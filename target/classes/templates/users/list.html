<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Danh sách Users</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <style>
        body {
            background-color: #f8f9fa;
        }

        .header-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .profile-img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .main-content {
            min-height: calc(100vh - 200px);
            padding: 30px 0;
        }

        .footer {
            background-color: #343a40;
            color: white;
            padding: 20px 0;
            margin-top: auto;
        }

        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 25px;
            padding: 10px 30px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .table th {
            background-color: #667eea;
            color: white;
            border: none;
        }

        .search-box {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .pagination .page-link {
            border-radius: 20px;
            margin: 0 2px;
            border: none;
            color: #667eea;
        }

        .pagination .page-item.active .page-link {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header-section">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-2 text-center">
                <img src="/uploads/avatars/avatar.jpg" alt="Profile" class="profile-img"
                    onerror="this.src='/images/default_image.png'">
                         onerror="this.src='https://via.placeholder.com/60x60/667eea/ffffff?text=TP'">
                </div>
                <div class="col-md-8">
                    <h1 class="navbar-brand mb-0">
                        <i class="fas fa-users me-2"></i>
                        Quản Lý Users
                    </h1>
                    <p class="mb-0 opacity-75">Hệ thống quản lý người dùng</p>
                </div>
                <div class="col-md-2 text-end">
                    <a href="/users" class="btn btn-outline-light">
                        <i class="fas fa-home me-1"></i>
                        Trang chủ
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Flash Messages -->
            <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
                <i class="fas fa-check-circle me-2"></i>
                <span th:text="${successMessage}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>

            <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="fas fa-exclamation-circle me-2"></i>
                <span th:text="${errorMessage}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>

            <!-- Page Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-list me-2"></i>Danh sách Users</h2>
                <a href="/users/new" class="btn btn-primary">
                    <i class="fas fa-plus me-2"></i>Thêm User
                </a>
            </div>

            <!-- Search and Filter -->
            <div class="search-box">
                <form th:action="@{/users}" method="get" class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">Tìm kiếm</label>
                        <input type="text" class="form-control" name="keyword"
                               th:value="${keyword}" placeholder="Nhập tên hoặc email...">
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Số bản ghi</label>
                        <select class="form-select" name="size">
                            <option value="5" th:selected="${pageSize == 5}">5</option>
                            <option value="10" th:selected="${pageSize == 10}">10</option>
                            <option value="20" th:selected="${pageSize == 20}">20</option>
                            <option value="50" th:selected="${pageSize == 50}">50</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Sắp xếp theo</label>
                        <select class="form-select" name="sortBy">
                            <option value="id" th:selected="${sortBy == 'id'}">ID</option>
                            <option value="fullname" th:selected="${sortBy == 'fullname'}">Họ tên</option>
                            <option value="email" th:selected="${sortBy == 'email'}">Email</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label class="form-label">Thứ tự</label>
                        <select class="form-select" name="sortDir">
                            <option value="asc" th:selected="${sortDir == 'asc'}">Tăng dần</option>
                            <option value="desc" th:selected="${sortDir == 'desc'}">Giảm dần</option>
                        </select>
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary me-2">
                            <i class="fas fa-search"></i>
                        </button>
                        <a href="/users" class="btn btn-outline-secondary">
                            <i class="fas fa-redo"></i>
                        </a>
                    </div>
                </form>
            </div>

            <!-- Results Info -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <span class="text-muted">
                    Hiển thị <strong th:text="${(currentPage * pageSize) + 1}">1</strong>
                    đến <strong th:text="${(currentPage * pageSize) + users.size()}">10</strong>
                    của <strong th:text="${totalItems}">100</strong> kết quả
                </span>
                <span class="text-muted" th:if="${keyword != null and !keyword.isEmpty()}">
                    Kết quả tìm kiếm cho: "<strong th:text="${keyword}">keyword</strong>"
                </span>
            </div>

            <!-- Users Table -->
            <div class="card">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>
                                        <a th:href="@{/users(page=${currentPage}, size=${pageSize}, sortBy='id', sortDir=${sortBy == 'id' ? reverseSortDir : 'asc'}, keyword=${keyword})}"
                                           class="text-decoration-none text-white">
                                            ID
                                            <i class="fas fa-sort" th:if="${sortBy != 'id'}"></i>
                                            <i class="fas fa-sort-up" th:if="${sortBy == 'id' and sortDir == 'asc'}"></i>
                                            <i class="fas fa-sort-down" th:if="${sortBy == 'id' and sortDir == 'desc'}"></i>
                                        </a>
                                    </th>
                                    <th>
                                        <a th:href="@{/users(page=${currentPage}, size=${pageSize}, sortBy='fullname', sortDir=${sortBy == 'fullname' ? reverseSortDir : 'asc'}, keyword=${keyword})}"
                                           class="text-decoration-none text-white">
                                            Họ tên
                                            <i class="fas fa-sort" th:if="${sortBy != 'fullname'}"></i>
                                            <i class="fas fa-sort-up" th:if="${sortBy == 'fullname' and sortDir == 'asc'}"></i>
                                            <i class="fas fa-sort-down" th:if="${sortBy == 'fullname' and sortDir == 'desc'}"></i>
                                        </a>
                                    </th>
                                    <th>
                                        <a th:href="@{/users(page=${currentPage}, size=${pageSize}, sortBy='email', sortDir=${sortBy == 'email' ? reverseSortDir : 'asc'}, keyword=${keyword})}"
                                           class="text-decoration-none text-white">
                                            Email
                                            <i class="fas fa-sort" th:if="${sortBy != 'email'}"></i>
                                            <i class="fas fa-sort-up" th:if="${sortBy == 'email' and sortDir == 'asc'}"></i>
                                            <i class="fas fa-sort-down" th:if="${sortBy == 'email' and sortDir == 'desc'}"></i>
                                        </a>
                                    </th>
                                    <th>Số điện thoại</th>
                                    <th width="200">Thao tác</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:if="${users.empty}">
                                    <td colspan="5" class="text-center py-4">
                                        <i class="fas fa-inbox fa-2x text-muted mb-3"></i>
                                        <p class="text-muted mb-0">Không có user nào được tìm thấy</p>
                                        <a href="/users/new" class="btn btn-primary mt-2">
                                            <i class="fas fa-plus me-1"></i>Thêm User đầu tiên
                                        </a>
                                    </td>
                                </tr>
                                <tr th:each="user : ${users}">
                                    <td th:text="${user.id}">1</td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <img th:src="@{/uploads/avatars/avatar.jpg}"
                                                 th:alt="${user.fullname}"
                                                 class="user-avatar me-2"
                                                 onerror="this.src='https://via.placeholder.com/40x40/667eea/ffffff?text=' + this.alt.charAt(0)">
                                            <strong th:text="${user.fullname}">User Name</strong>
                                        </div>
                                    </td>
                                    <td th:text="${user.email}">user@example.com</td>
                                    <td th:text="${user.phone}">0123456789</td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <a th:href="@{/users/view/{id}(id=${user.id})}"
                                               class="btn btn-sm btn-outline-info" title="Xem chi tiết">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a th:href="@{/users/edit/{id}(id=${user.id})}"
                                               class="btn btn-sm btn-outline-warning" title="Chỉnh sửa">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <button type="button" class="btn btn-sm btn-outline-danger"
                                                    title="Xóa" onclick="confirmDelete([[${user.id}]], '[[${user.fullname}]]')">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Pagination -->
            <div th:if="${totalPages > 1}" class="d-flex justify-content-center mt-4">
                <nav>
                    <ul class="pagination">
                        <!-- First Page -->
                        <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                            <a class="page-link" th:href="@{/users(page=0, size=${pageSize}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword})}">
                                <i class="fas fa-angle-double-left"></i>
                            </a>
                        </li>

                        <!-- Previous Page -->
                        <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                            <a class="page-link" th:href="@{/users(page=${currentPage - 1}, size=${pageSize}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword})}">
                                <i class="fas fa-angle-left"></i>
                            </a>
                        </li>

                        <!-- Page Numbers -->
                        <th:block th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                                  th:if="${i >= (currentPage - 2) and i <= (currentPage + 2)}">
                            <li class="page-item" th:classappend="${i == currentPage} ? 'active'">
                                <a class="page-link" th:href="@{/users(page=${i}, size=${pageSize}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword})}"
                                   th:text="${i + 1}">1</a>
                            </li>
                        </th:block>

                        <!-- Next Page -->
                        <li class="page-item" th:classappend="${currentPage >= totalPages - 1} ? 'disabled'">
                            <a class="page-link" th:href="@{/users(page=${currentPage + 1}, size=${pageSize}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword})}">
                                <i class="fas fa-angle-right"></i>
                            </a>
                        </li>

                        <!-- Last Page -->
                        <li class="page-item" th:classappend="${currentPage >= totalPages - 1} ? 'disabled'">
                            <a class="page-link" th:href="@{/users(page=${totalPages - 1}, size=${pageSize}, sortBy=${sortBy}, sortDir=${sortDir}, keyword=${keyword})}">
                                <i class="fas fa-angle-double-right"></i>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5><i class="fas fa-graduation-cap me-2"></i>Thông tin sinh viên</h5>
                    <p class="mb-1"><strong>Họ tên:</strong> Trần Phúc Toàn</p>
                    <p class="mb-1"><strong>MSSV:</strong> 23110344</p>
                    <p class="mb-0"><strong>Lớp:</strong> 231102A</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <h5><i class="fas fa-info-circle me-2"></i>Dự án</h5>
                    <p class="mb-1"><strong>Môn học:</strong> Lập trình Web</p>
                    <p class="mb-1"><strong>Chủ đề:</strong> User Management với Spring Boot</p>
                    <p class="mb-0"><strong>Năm:</strong> 2025</p>
                </div>
            </div>
            <hr class="my-3">
            <div class="text-center">
                <small>&copy; 2025 Trần Phúc Toàn - 23110344</small>
            </div>
        </div>
    </footer>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Xác nhận xóa</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Bạn có chắc chắn muốn xóa user "<span id="userName"></span>" không?</p>
                    <p class="text-danger"><small>Hành động này không thể hoàn tác.</small></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <form id="deleteForm" method="post" style="display: inline;">
                        <button type="submit" class="btn btn-danger">Xóa</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        function confirmDelete(id, name) {
            document.getElementById('userName').textContent = name;
            document.getElementById('deleteForm').action = '/users/delete/' + id;
            new bootstrap.Modal(document.getElementById('deleteModal')).show();
        }

        // Auto hide alerts after 5 seconds
        setTimeout(function() {
            var alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                var bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);
    </script>
</body>
</html>
